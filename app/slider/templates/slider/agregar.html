{% extends 'base.html' %}

{% block title %}
    {{ 'Editar' if slider else 'Agregar' }} Slider
{% endblock %}

{% block content %}
    <h1 class="h3 my-4 text-underline">{{ 'Editar' if slider else 'Agregar' }} Slider</h1>

    <form 
        action="{{ url_for('slider.editar', id=slider.id) if slider else url_for('slider.agregar') }}" 
        method="POST" 
        enctype="multipart/form-data" 
        class="shadow p-4 rounded"
    >
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <!-- Título -->
        <div class="form-group mb-3">
            <label for="titulo">Título</label>
            <input 
                type="text" 
                class="form-control" 
                id="titulo" 
                name="titulo" 
                value="{{ slider.titulo if slider else '' }}" 
                required
            >
        </div>

        <!-- Imagen -->
        <div class="form-group mb-3">
            <label for="imagen">Imagen</label>
            <input 
                type="file" 
                class="form-control" 
                id="imagen" 
                name="imagen"
            >
            
            {% if slider and slider.imagen %}
                <div class="mt-2">
                    <p class="mb-1">Imagen actual:</p>
                    <img 
                        id="current-imagen" 
                        src="{{ url_for('static', filename='uploads/' + slider.imagen) }}" 
                        alt="Imagen actual" 
                        width="100"
                    >
                </div>
            {% endif %}

            <div class="mt-2">
                <p class="mb-1">Vista previa:</p>
                <img 
                    id="edit-imagen-preview" 
                    src="#" 
                    alt="Vista previa de la imagen" 
                    width="100" 
                    style="display:none;"
                >
            </div>
        </div>

        <!-- Estado -->
        <div class="form-group mb-3">
            <label for="estado">Estado</label>
            <select 
                class="form-control" 
                id="estado" 
                name="estado" 
                required
            >
                <option 
                    value="Activo" 
                    {% if slider and slider.estado == 'Activo' %}selected{% endif %}
                >
                    Activo
                </option>
                <option 
                    value="Inactivo" 
                    {% if slider and slider.estado == 'Inactivo' %}selected{% endif %}
                >
                    Inactivo
                </option>
            </select>
        </div>

        <!-- Botones -->
        <div class="mt-4">
            <button type="submit" class="btn btn-primary">
                {{ 'Actualizar' if slider else 'Guardar' }}
            </button>
            <a href="{{ url_for('slider.index') }}" class="btn btn-secondary ms-2">
                Volver al listado
            </a>
        </div>
    </form>

    <!-- Script para vista previa de la imagen -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const imagenInput = document.getElementById('imagen');
            const preview = document.getElementById('edit-imagen-preview');
            const currentImage = document.getElementById('current-imagen');
            
            imagenInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                        if (currentImage) {
                            currentImage.style.display = 'none';
                        }
                    };
                    reader.readAsDataURL(file);
                } else {
                    preview.style.display = 'none';
                    if (currentImage) {
                        currentImage.style.display = 'block';
                    }
                }
            });
        });
    </script>
{% endblock %}
